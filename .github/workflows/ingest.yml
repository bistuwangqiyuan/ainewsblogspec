name: Ingestion (Daily)

on:
    schedule:
        - cron: '0 1 * * *' # 09:00 CST
    workflow_dispatch: {}

jobs:
    run:
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v4
            - uses: actions/setup-node@v4
              with:
                  node-version: '20'
            - run: corepack enable
            - run: pnpm install --frozen-lockfile
            - name: Run ingestion
              run: node --loader ts-node/esm scripts/ingest.ts
              env:
                  SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
                  SUPABASE_SERVICE_ROLE: ${{ secrets.SUPABASE_SERVICE_ROLE }}
