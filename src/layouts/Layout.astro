---
import '../../src/styles/globals.css';
import '@fontsource-variable/inter/wght.css';
import interWoff2 from '@fontsource-variable/inter/files/inter-latin-wght-normal.woff2?url';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

interface Props {
    title: string;
    description?: string;
    keywords?: string;
    image?: string;
    article?: boolean;
    publishedTime?: string;
    author?: string;
    canonicalURL?: string;
}

const { 
    title, 
    description = 'AI 编程工具与实践的中文资讯聚合，提供最新的AI编程新闻、工具、教程和实践案例，支持分页、筛选与排序。',
    keywords = 'AI编程,人工智能,编程工具,AI新闻,编程资讯,机器学习,深度学习,AI开发',
    image = '/images/og-image.jpg',
    article = false,
    publishedTime,
    author = 'AI编程资讯',
    canonicalURL
} = Astro.props;

const siteURL = Astro.site?.toString() || Astro.url.origin;
const currentURL = canonicalURL || Astro.url.toString();
const imageURL = image.startsWith('http') ? image : new URL(image, siteURL).toString();

// Remove trailing slash from canonical URL for consistency
const cleanCanonicalURL = currentURL.endsWith('/') && currentURL !== siteURL ? currentURL.slice(0, -1) : currentURL;
---

<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        
        <!-- Primary Meta Tags -->
        <title>{title}</title>
        <meta name="title" content={title} />
        <meta name="description" content={description} />
        <meta name="keywords" content={keywords} />
        <meta name="author" content={author} />
        <meta name="generator" content={Astro.generator} />
        <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
        <link rel="canonical" href={cleanCanonicalURL} />
        
        <!-- Open Graph / Facebook -->
        <meta property="og:type" content={article ? 'article' : 'website'} />
        <meta property="og:url" content={currentURL} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={imageURL} />
        <meta property="og:site_name" content="AI编程资讯聚合" />
        <meta property="og:locale" content="zh_CN" />
        {article && publishedTime && <meta property="article:published_time" content={publishedTime} />}
        {article && author && <meta property="article:author" content={author} />}
        
        <!-- Twitter -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:url" content={currentURL} />
        <meta name="twitter:title" content={title} />
        <meta name="twitter:description" content={description} />
        <meta name="twitter:image" content={imageURL} />
        
        <!-- Additional SEO -->
        <meta name="theme-color" content="#000000" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
        
        <!-- Structured Data - Organization -->
        <script type="application/ld+json" set:html={JSON.stringify({
            '@context': 'https://schema.org',
            '@type': 'Organization',
            name: 'AI编程资讯聚合',
            url: siteURL,
            logo: `${siteURL}images/og-image.svg`,
            description: 'AI编程工具与实践的中文资讯聚合平台',
            sameAs: [
                `${siteURL}about`,
                `${siteURL}contact`
            ],
            contactPoint: {
                '@type': 'ContactPoint',
                contactType: '客户支持',
                url: `${siteURL}contact`
            }
        })} />
        
        <!-- Structured Data - Page/Article -->
        <script type="application/ld+json" set:html={JSON.stringify({
            '@context': 'https://schema.org',
            '@type': article ? 'Article' : 'WebSite',
            name: title,
            description: description,
            url: currentURL,
            inLanguage: 'zh-CN',
            image: imageURL,
            ...(article ? {
                headline: title,
                datePublished: publishedTime,
                dateModified: publishedTime || new Date().toISOString(),
                author: {
                    '@type': 'Organization',
                    name: author,
                    url: siteURL
                },
                publisher: {
                    '@type': 'Organization',
                    name: 'AI编程资讯',
                    logo: {
                        '@type': 'ImageObject',
                        url: `${siteURL}images/og-image.svg`
                    }
                },
                mainEntityOfPage: {
                    '@type': 'WebPage',
                    '@id': currentURL
                }
            } : {
                potentialAction: {
                    '@type': 'SearchAction',
                    target: {
                        '@type': 'EntryPoint',
                        urlTemplate: `${siteURL}?q={search_term_string}`
                    },
                    'query-input': 'required name=search_term_string'
                }
            })
        })} />
        
        <!-- Icons & Manifest -->
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="icon" type="image/svg+xml" sizes="any" href="/favicon.svg" />
        <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png.svg" />
        <link rel="icon" type="image/svg+xml" sizes="192x192" href="/icon-192.png.svg" />
        <link rel="icon" type="image/svg+xml" sizes="512x512" href="/icon-512.png.svg" />
        <link rel="manifest" href="/manifest.json" />
        <meta name="msapplication-TileColor" content="#6366f1" />
        <meta name="msapplication-config" content="/browserconfig.xml" />
        
        <!-- RSS Feed -->
        <link rel="alternate" type="application/rss+xml" title="AI编程资讯聚合 RSS Feed" href="/rss.xml" />
        
        <!-- Preload & Performance -->
        <link rel="preload" as="font" type="font/woff2" href={interWoff2} crossorigin="anonymous" />
        <link rel="dns-prefetch" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin />
        <link rel="dns-prefetch" href="https://fonts.gstatic.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        
        <!-- Prefetch important pages -->
        <link rel="prefetch" href="/about" />
        <link rel="prefetch" href="/contact" />
        
        <!-- Performance & Optimization hints -->
        <meta name="format-detection" content="telephone=no" />
        <meta http-equiv="x-dns-prefetch-control" content="on" />
        <meta name="color-scheme" content="dark light" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-title" content="AI编程资讯" />
        
        <!-- Geo tags (for Chinese audience) -->
        <meta name="geo.region" content="CN" />
        <meta name="geo.placename" content="China" />
        <meta name="language" content="zh-CN" />
        
        <!-- Additional Open Graph -->
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="630" />
        <meta property="og:image:alt" content={title} />
        
        <!-- Twitter additional -->
        <meta name="twitter:creator" content="@AI编程资讯" />
        <meta name="twitter:site" content="@AI编程资讯" />
        
        <!-- Humans.txt -->
        <link rel="author" href="/humans.txt" />
        
        <!-- Additional head content -->
        <slot name="head" />
    </head>
    <body class="antialiased text-white bg-complementary">
        <div class="flex flex-col min-h-screen px-6 bg-noise sm:px-12">
            <div class="flex flex-col w-full max-w-5xl mx-auto grow">
                <Header />
                <main class="grow"><slot /></main>
                <Footer />
            </div>
        </div>
    </body>
</html>
